Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),r=require("dequal/lite");function n(e,r,n,t){return new(n||(n=Promise))(function(u,i){function a(e){try{c(t.next(e))}catch(e){i(e)}}function o(e){try{c(t.throw(e))}catch(e){i(e)}}function c(e){var r;e.done?u(e.value):(r=e.value,r instanceof n?r:new n(function(e){e(r)})).then(a,o)}c((t=t.apply(e,r||[])).next())})}function t(e,r){var n,t,u,i,a={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,t&&(u=2&i[0]?t.return:i[0]?t.throw||((u=t.return)&&u.call(t),0):t.next)&&!(u=u.call(t,i[1])).done)return u;switch(t=0,u&&(i=[2&i[0],u.value]),i[0]){case 0:case 1:u=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,t=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(u=a.trys,(u=u.length>0&&u[u.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!u||i[1]>u[0]&&i[1]<u[3])){a.label=i[1];break}if(6===i[0]&&a.label<u[1]){a.label=u[1],u=i;break}if(u&&a.label<u[2]){a.label=u[2],a.ops.push(i);break}u[2]&&a.ops.pop(),a.trys.pop();continue}i=r.call(e,a)}catch(e){i=[6,e],t=0}finally{n=u=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}}var u={}[0],i=function(e){return e===u},a=function(e){return"function"==typeof e},o=function(){},c=function(e,r){return Object.assign({},e,r)},s=!0,f="undefined"!=typeof window,l="undefined"!=typeof document,d=f&&window.addEventListener||o,v=l&&document.addEventListener||o,h={isOnline:function(){return s},isVisible:function(){var e=l&&document.visibilityState;return!!i(e)||"hidden"!==e}},g={initFocus:function(e){v("visibilitychange",e),d("focus",e)},initReconnect:function(e){d("online",function(){s=!0,e()}),d("offline",function(){s=!1})}},p="undefined"==typeof window||"Deno"in window,b=p?null:window.requestAnimationFrame,y=b?function(e){return b(e)}:function(e){return setTimeout(e,1)},w=p?e.useEffect:e.useLayoutEffect,m="undefined"!=typeof navigator&&navigator.connection,R=!p&&m&&(["slow-2g","2g"].includes(m.effectiveType)||m.saveData),k=new WeakMap,x=0;function O(e){if(a(e))try{e=e()}catch(r){e=""}var r;return Array.isArray(e)?(r=e,e=function(e){if(!e.length)return"";for(var r="arg",n=0;n<e.length;++n){var t=e[n],i=u;null===t||"object"!=typeof t&&!a(t)?i=JSON.stringify(t):k.has(t)?i=k.get(t):(i=x,k.set(t,x++)),r+="$"+i}return r}(e)):r=[e=String(e||"")],[e,r,e?"$err$"+e:"",e?"$req$"+e:""]}var S=new WeakMap,V=function(e,r,n,t,u,i){void 0===i&&(i=!1);var a=S.get(e),o=a[0],c=a[1],s=o[r],f=c[r];if(f)for(var l=0;l<f.length;++l)f[l](n,t,u);return i&&s&&s[0]?s[0](2).then(function(){return e.get(r)}):e.get(r)},C=0,E=function(){return++C},T=function(e,r,o,c){return void 0===c&&(c=!0),n(void 0,void 0,void 0,function(){var n,s,f,l,d,v,h,g,p,b,y;return t(this,function(t){switch(t.label){case 0:if(n=O(r),s=n[0],f=n[2],!s)return[2];if(l=S.get(e),d=l[2],v=l[3],i(o))return[2,V(e,s,e.get(s),e.get(f),u,c)];if(p=d[s]=E(),v[s]=0,a(o))try{o=o(e.get(s))}catch(e){o=u,g=e}if(!o||!a(o.then))return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,o];case 2:return h=t.sent(),[3,4];case 3:return b=t.sent(),g=b,[3,4];case 4:if(p!==d[s]){if(g)throw g;return[2,h]}return[3,6];case 5:h=o,t.label=6;case 6:return i(h)||e.set(s,h),e.set(f,g),v[s]=E(),[4,V(e,s,h,g,u,c)];case 7:if(y=t.sent(),g)throw g;return[2,y]}})})};function I(e,r){for(var n in e)e[n][0]&&e[n][0](r)}function q(e,r){if(!S.has(e)){var n=c(g,r),t={},i=T.bind(u,e);return S.set(e,[t,{},{},{},{},{},i]),p||(n.initFocus(I.bind(u,t,0)),n.initReconnect(I.bind(u,t,1))),[e,i]}}var P=q(new Map),W=P[0],M=P[1],D=c({onLoadingSlow:o,onSuccess:o,onError:o,onErrorRetry:function(e,r,n,t,u){if(h.isVisible()){var a=n.errorRetryCount,o=u.retryCount,c=~~((Math.random()+.5)*(1<<(o<8?o:8)))*n.errorRetryInterval;!i(a)&&o>a||setTimeout(t,c,u)}},revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:R?1e4:5e3,focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:R?5e3:3e3,compare:r.dequal,isPaused:function(){return!1},cache:W,mutate:M,fallback:{}},h);function F(e,r){var n=c(e,r);if(!r)return n;var t=e.use,u=e.fallback,i=r.use,a=r.fallback;return t&&i&&(n.use=t.concat(i)),u&&a&&(n.fallback=c(u,a)),n}var L=e.createContext({});function $(e){return a(e[1])?[e[0],e[1],e[2]||{}]:[e[0],null,(null===e[1]?e[2]:e[1])||{}]}var j,A=function(e,r,n){var t=r[e]||(r[e]=[]);return t.push(n),function(){var e=t.indexOf(n);e>=0&&(t[e]=t[t.length-1],t.pop())}},_={dedupe:!0},z=Object.defineProperty(function(r){var n=r.children,t=r.value,i=F(e.useContext(L),t),a=t&&t.provider,o=e.useState(function(){return a?q(a(i.cache||W),t):u})[0];return o&&(i.cache=o[0],i.mutate=o[1]),e.createElement(L.Provider,{value:i},n)},"default",{value:D}),G=(j=function(r,a,o){var s=o.cache,f=o.compare,l=o.fallbackData,d=o.suspense,v=o.revalidateOnMount,h=o.refreshInterval,g=o.refreshWhenHidden,b=o.refreshWhenOffline,m=S.get(s),R=m[0],k=m[1],x=m[2],C=m[3],I=m[4],q=m[5],P=O(r),W=P[0],M=P[1],D=P[2],F=P[3],L=e.useRef(!1),$=e.useRef(!1),j=e.useRef(W),z=e.useRef(o),G=function(){return z.current},H=s.get(W),J=i(l)?o.fallback[W]:l,N=i(H)?J:H,B=s.get(D);if(d&&(!W||!a))throw new Error("useSWR requires either key or fetcher with suspense mode");var K=function(){return i(v)?d?!L.current&&!i(N):i(N)||o.revalidateIfStale:v},Q=!(!W||!a)&&(!!s.get(F)||!L.current&&K()),U=function(r,n){var t=e.useState({})[1],u=e.useRef(r),i=e.useRef({data:!1,error:!1,isValidating:!1}),a=e.useCallback(function(e){var r=!1,a=u.current;for(var o in e){var c=o;a[c]!==e[c]&&(a[c]=e[c],i.current[c]&&(r=!0))}r&&!n.current&&t({})},[]);return w(function(){u.current=r}),[u,i.current,a]}({data:N,error:B,isValidating:Q},$),X=U[0],Y=U[1],Z=U[2],ee=e.useCallback(function(e){return n(void 0,void 0,void 0,function(){var r,n,c,l,d,v,h,g,p;return t(this,function(t){switch(t.label){case 0:if(!W||!a||$.current||G().isPaused())return[2,!1];c=!0,l=e||{},d=!i(I[W])&&l.dedupe,v=function(){return!$.current&&W===j.current&&L.current},h=function(){delete I[W],delete q[W]},t.label=1;case 1:return t.trys.push([1,6,,7]),s.set(F,!0),Z({isValidating:!0}),d||V(s,W,X.current.data,X.current.error,!0),d?(n=q[W],[4,I[W]]):[3,3];case 2:return r=t.sent(),[3,5];case 3:return o.loadingTimeout&&!s.get(W)&&setTimeout(function(){c&&v()&&G().onLoadingSlow(W,o)},o.loadingTimeout),q[W]=n=E(),[4,I[W]=a.apply(a,M)];case 4:r=t.sent(),setTimeout(function(){q[W]===n&&h()},o.dedupingInterval),v()&&G().onSuccess(r,W,o),t.label=5;case 5:return q[W]!==n?[2,!1]:(s.set(D,u),s.set(F,!1),g={isValidating:!1},!i(x[W])&&(n<=x[W]||n<=C[W]||0===C[W])?(Z(g),[2,!1]):(i(X.current.error)||(g.error=u),f(X.current.data,r)||(g.data=r),f(s.get(W),r)||s.set(W,r),Z(g),d||V(s,W,r,g.error,!1),[3,7]));case 6:return p=t.sent(),h(),s.set(F,!1),G().isPaused()?(Z({isValidating:!1}),[2,!1]):(s.set(D,p),X.current.error!==p&&(Z({isValidating:!1,error:p}),d||V(s,W,u,p,!1)),v()&&(G().onError(p,W,o),o.shouldRetryOnError&&G().onErrorRetry(p,W,o,ee,{retryCount:(l.retryCount||0)+1,dedupe:!0})),[3,7]);case 7:return c=!1,[2,!0]}})})},[W]),re=e.useCallback(function(e,r){return T(s,j.current,e,r)},[]);if(w(function(){z.current=o}),w(function(){if(W){var e=L.current,r=ee.bind(u,_),n=function(){return G().isVisible()&&G().isOnline()},t=0,a=A(W,k,function(e,r,n){Z(c({error:r,isValidating:n},f(e,X.current.data)?null:{data:e}))}),o=A(W,R,function(e){if(0===e){var u=Date.now();G().revalidateOnFocus&&u>t&&n()&&(t=u+G().focusThrottleInterval,r())}else if(1===e)G().revalidateOnReconnect&&n()&&r();else if(2===e)return ee()});return $.current=!1,j.current=W,e&&Z({data:N,error:B,isValidating:Q}),K()&&(i(N)||p?r():y(r)),L.current=!0,function(){$.current=!0,a(),o()}}},[W,ee]),w(function(){var e;function r(){h&&-1!==e&&(e=setTimeout(n,h))}function n(){X.current.error||!g&&!G().isVisible()||!b&&!G().isOnline()?r():ee(_).then(function(){return r()})}return r(),function(){e&&(clearTimeout(e),e=-1)}},[h,g,b,ee]),e.useDebugValue(N),d&&i(N))throw i(B)?ee(_):B;return{mutate:re,get data(){return Y.data=!0,N},get error(){return Y.error=!0,B},get isValidating(){return Y.isValidating=!0,Q}}},function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var t=$(r),u=t[0],i=t[1],a=t[2],o=c(D,e.useContext(L)),s=F(o,a),f=j,l=s.use;if(l)for(var d=l.length;d-- >0;)f=l[d](f);return f(u,i||s.fetcher,s)});exports.SWRConfig=z,exports.default=G,exports.mutate=M,exports.unstable_serialize=function(e){return O(e)[0]},exports.useSWRConfig=function(){return c(D,e.useContext(L))};
